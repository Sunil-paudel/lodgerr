module.exports = {

"[project]/.next-internal/server/app/api/bookings/[bookingId]/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/@opentelemetry/api [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@opentelemetry/api", () => require("@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/mongoose [external] (mongoose, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("mongoose", () => require("mongoose"));

module.exports = mod;
}}),
"[project]/src/utils/db.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/mongoose [external] (mongoose, cjs)");
;
__TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].set('strictQuery', false);
// Ensure this MONGODB_URL is correct and your IP is whitelisted if using Atlas.
const MONGODB_URL = "mongodb+srv://paudelsunil16:paudelsunil16@cluster0.dlua3bq.mongodb.net/";
const connectDB = async ()=>{
    if (__TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].connection.readyState >= 1) {
        console.log("MongoDB is already connected.");
        return;
    }
    try {
        if ("TURBOPACK compile-time falsy", 0) {
            "TURBOPACK unreachable";
        }
        console.log("[DB Connect] Attempting to connect to MongoDB...");
        await __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].connect(MONGODB_URL);
        console.log("[DB Connect] MongoDB connected successfully.");
    } catch (error) {
        console.error("[DB Connect] MongoDB connection failed:", error.message);
        if (error.stack) {
            console.error("[DB Connect] MongoDB connection error stack:", error.stack);
        } else {
            console.error("[DB Connect] MongoDB connection error details:", error);
        }
        // Construct a new error to ensure it's an Error instance with a clear message
        throw new Error("Database connection failed: " + error.message);
    }
};
const __TURBOPACK__default__export__ = connectDB;
}}),
"[project]/src/models/User.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/mongoose [external] (mongoose, cjs)");
;
const userSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["Schema"]({
    name: {
        type: String,
        required: true
    },
    email: {
        type: String,
        required: true,
        unique: true
    },
    passwordHash: {
        type: String
    },
    role: {
        type: String,
        enum: [
            "guest",
            "host",
            "admin"
        ],
        default: "guest"
    },
    stripeAccountId: {
        type: String
    },
    avatarUrl: {
        type: String
    }
}, {
    timestamps: true,
    toJSON: {
        virtuals: true,
        transform: function(doc, ret) {
            ret.id = ret._id.toString(); // map _id to id
            delete ret._id;
            delete ret.passwordHash; // remove passwordHash
            delete ret.__v; // remove __v
        }
    },
    toObject: {
        virtuals: true,
        transform: function(doc, ret) {
            ret.id = ret._id.toString();
            delete ret._id;
            delete ret.passwordHash;
            delete ret.__v;
        }
    }
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.User || __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("User", userSchema);
}}),
"[project]/src/app/api/auth/[...nextauth]/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "GET": (()=>handler),
    "POST": (()=>handler),
    "authOptions": (()=>authOptions)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/providers/credentials.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/bcryptjs/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$utils$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/utils/db.ts [app-route] (ecmascript)"); // MongoDB connection utility
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$User$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/models/User.ts [app-route] (ecmascript)"); // Mongoose User model
;
;
;
;
;
// Check for NEXTAUTH_SECRET at module load time
if (!process.env.NEXTAUTH_SECRET) {
    console.warn("\x1b[33m%s\x1b[0m", "[NextAuth Warning] NEXTAUTH_SECRET environment variable is not set! " + "Authentication will not work reliably. Please ensure it is set in your environment.");
}
const authOptions = {
    // === Authentication Providers ===
    providers: [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            id: "credentials",
            name: "Credentials",
            // Fields for sign-in formx
            credentials: {
                email: {
                    label: "Email",
                    type: "text",
                    placeholder: "jsmith@example.com"
                },
                password: {
                    label: "Password",
                    type: "password"
                }
            },
            // Core login logic
            async authorize (credentials) {
                console.log("[Authorize] Credentials received:", credentials ? {
                    email: credentials.email,
                    password_exists: !!credentials.password
                } : "null_credentials");
                // Validate input
                if (!credentials?.email || !credentials?.password) {
                    console.log("[Authorize] Missing email or password.");
                    throw new Error("Please enter both email and password.");
                }
                try {
                    console.log("[Authorize] Connecting to DB...");
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$utils$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])();
                    console.log("[Authorize] DB connection successful.");
                    const user = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$User$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findOne({
                        email: credentials.email
                    });
                    if (!user) {
                        console.log("[Authorize] No user found with email:", credentials.email);
                        throw new Error("No user found with this email.");
                    }
                    if (!user.passwordHash) {
                        console.log("[Authorize] User has no password set:", credentials.email);
                        throw new Error("User account is not properly configured for password login.");
                    }
                    const isValidPassword = await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].compare(credentials.password, user.passwordHash);
                    if (!isValidPassword) {
                        console.log("[Authorize] Incorrect password for:", credentials.email);
                        throw new Error("Invalid password.");
                    }
                    // Success: Return user data matching the `User` interface in next-auth.d.ts
                    console.log("[Authorize] Login success for user:", user._id.toString(), user.email);
                    return {
                        id: user._id.toString(),
                        name: user.name,
                        email: user.email,
                        image: user.avatarUrl,
                        role: user.role
                    };
                } catch (error) {
                    console.error("[Authorize] Unexpected error:", error.message, error.stack);
                    // Re-throw specific known errors for NextAuth to handle and potentially display to user
                    if ([
                        "No user found with this email.",
                        "Invalid password.",
                        "User account is not properly configured for password login.",
                        "Please enter both email and password."
                    ].includes(error.message) || error.message.startsWith("Database connection failed:") || error.message.startsWith("Server configuration error:")) {
                        throw error;
                    }
                    // For other unexpected errors, throw a generic message
                    throw new Error("Authentication failed due to an unexpected server issue. Please try again.");
                }
            }
        })
    ],
    // === Session Configuration ===
    session: {
        strategy: "jwt"
    },
    // === Callback Functions ===
    callbacks: {
        // Modify JWT on login or session update
        async jwt ({ token, user, trigger, session: newSessionData }) {
            try {
                // On initial sign in, the `user` object from `authorize` is available
                if (user) {
                    console.log("[JWT Callback] Initial user object from authorize:", user);
                    token.id = user.id;
                    token.name = user.name;
                    token.email = user.email;
                    token.picture = user.image; // `user.image` from authorize maps to `token.picture`
                    token.role = user.role;
                }
                // Handle session updates (e.g., user updates profile)
                if (trigger === "update" && newSessionData?.user) {
                    console.log("[JWT Callback] Updating token from session update data:", newSessionData.user);
                    token.name = newSessionData.user.name;
                    token.email = newSessionData.user.email;
                    token.picture = newSessionData.user.image;
                    token.role = newSessionData.user.role;
                }
                console.log("[JWT Callback] Token before returning:", token);
                return token;
            } catch (error) {
                console.error("[JWT Callback] Error in JWT callback:", error.message, error.stack);
                // Return existing token or throw to signify critical failure.
                // Returning existing token might lead to inconsistent state if update failed.
                // For now, returning token to prevent complete session breakage if possible.
                return token;
            }
        },
        // Attach token data to session for use on client side
        async session ({ session, token }) {
            try {
                console.log("[Session Callback] Token received:", token);
                if (token) {
                    // Ensure session.user exists and is structured according to `next-auth.d.ts`
                    session.user = {
                        id: token.id,
                        name: token.name,
                        email: token.email,
                        image: token.picture,
                        role: token.role
                    };
                }
                console.log("[Session Callback] Session user before returning:", session.user);
                return session;
            } catch (error) {
                console.error("[Session Callback] Error in session callback:", error.message, error.stack);
                // Return existing session to prevent complete breakage if possible.
                return session;
            }
        }
    },
    // === Custom Auth Pages ===
    pages: {
        signIn: "/login",
        error: "/login"
    },
    // === Secret for signing JWT ===
    secret: process.env.NEXTAUTH_SECRET
};
// Export for Next.js API routes
const handler = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(authOptions);
;
}}),
"[project]/src/models/Booking.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/mongoose [external] (mongoose, cjs)");
;
const bookingSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["Schema"]({
    listingId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["Schema"].Types.ObjectId,
        ref: 'Property',
        required: true
    },
    guestId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["Schema"].Types.ObjectId,
        ref: 'User',
        required: true
    },
    startDate: {
        type: Date,
        required: true
    },
    endDate: {
        type: Date,
        required: true
    },
    totalPrice: {
        type: Number,
        required: true,
        min: 0
    },
    paymentStatus: {
        type: String,
        enum: [
            'pending',
            'paid',
            'failed',
            'refunded'
        ],
        required: true,
        default: 'pending'
    },
    bookingStatus: {
        type: String,
        enum: [
            'pending_confirmation',
            'pending_payment',
            'confirmed_by_host',
            'rejected_by_host',
            'cancelled_by_guest',
            'cancelled_by_admin',
            'completed',
            'no_show'
        ],
        required: true,
        default: 'pending_confirmation'
    }
}, {
    timestamps: true
});
bookingSchema.index({
    listingId: 1,
    startDate: 1,
    endDate: 1
});
bookingSchema.index({
    guestId: 1
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.Booking || __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("Booking", bookingSchema);
}}),
"[project]/src/models/Property.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/mongoose [external] (mongoose, cjs)");
;
const propertySchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["Schema"]({
    hostId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["Schema"].Types.ObjectId,
        ref: 'User',
        required: true
    },
    title: {
        type: String,
        required: true,
        trim: true
    },
    description: {
        type: String,
        required: true
    },
    price: {
        type: Number,
        required: true,
        min: 0
    },
    pricePeriod: {
        type: String,
        enum: [
            'nightly',
            'weekly',
            'monthly'
        ],
        required: true,
        default: 'nightly'
    },
    location: {
        type: String,
        required: true,
        trim: true
    },
    address: {
        type: String,
        trim: true
    },
    maxGuests: {
        type: Number,
        required: true,
        min: 1
    },
    images: {
        type: [
            String
        ],
        validate: {
            validator: function(v) {
                return v == null || v.length === 0 || v.every((url)=>typeof url === 'string' && url.startsWith('http'));
            },
            message: 'All image entries must be valid URLs.'
        },
        default: []
    },
    bedrooms: {
        type: Number,
        required: true,
        min: 0
    },
    bathrooms: {
        type: Number,
        required: true,
        min: 0
    },
    amenities: {
        type: [
            String
        ],
        default: []
    },
    type: {
        type: String,
        enum: [
            'House',
            'Apartment',
            'Room',
            'Unique Stay'
        ],
        required: true
    },
    host: {
        name: {
            type: String,
            required: true
        },
        avatarUrl: {
            type: String
        }
    },
    rating: {
        type: Number,
        min: 0,
        max: 5
    },
    reviewsCount: {
        type: Number,
        min: 0,
        default: 0
    },
    availableFrom: {
        type: Date,
        required: false
    },
    availableTo: {
        type: Date,
        required: false
    }
}, {
    timestamps: true,
    toJSON: {
        virtuals: true,
        transform: function(doc, ret) {
            ret.id = ret._id.toString();
            delete ret._id;
            delete ret.__v;
            if (ret.hostId instanceof __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Types.ObjectId) {
                ret.hostId = ret.hostId.toString();
            }
        // Transformation for bookedDateRanges is removed
        }
    },
    toObject: {
        virtuals: true,
        transform: function(doc, ret) {
            ret.id = ret._id.toString();
            delete ret._id;
            delete ret.__v;
            if (ret.hostId instanceof __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Types.ObjectId) {
                ret.hostId = ret.hostId.toString();
            }
        // Transformation for bookedDateRanges is removed
        }
    }
});
propertySchema.index({
    location: 'text',
    title: 'text',
    description: 'text'
});
propertySchema.index({
    hostId: 1
});
propertySchema.index({
    createdAt: -1
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.Property || __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("Property", propertySchema);
}}),
"[project]/src/models/BookedDateRange.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/mongoose [external] (mongoose, cjs)");
;
const bookedDateRangeSchema = new __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["Schema"]({
    propertyId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["Schema"].Types.ObjectId,
        ref: 'Property',
        required: true,
        index: true
    },
    bookingId: {
        type: __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["Schema"].Types.ObjectId,
        ref: 'Booking',
        required: true,
        unique: true,
        index: true
    },
    startDate: {
        type: Date,
        required: true
    },
    endDate: {
        type: Date,
        required: true
    },
    status: {
        type: String,
        enum: [
            'pending_confirmation',
            'pending_payment',
            'confirmed_by_host',
            'rejected_by_host',
            'cancelled_by_guest',
            'cancelled_by_admin',
            'completed',
            'no_show'
        ],
        required: true,
        index: true
    }
}, {
    timestamps: true
});
// Compound index to quickly find overlapping ranges for a property
bookedDateRangeSchema.index({
    propertyId: 1,
    startDate: 1,
    endDate: 1
});
bookedDateRangeSchema.index({
    propertyId: 1,
    status: 1
});
const __TURBOPACK__default__export__ = __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].models.BookedDateRange || __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].model("BookedDateRange", bookedDateRangeSchema);
}}),
"[project]/src/app/api/bookings/[bookingId]/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"602adb3d8820c6476b5b7719ffc1ce4697076f5937":"GET","60846f5e79d056fa6b0ac9fb9099fa4a113147344b":"DELETE"},"",""] */ __turbopack_context__.s({
    "DELETE": (()=>DELETE),
    "GET": (()=>GET)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$next$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next-auth/next/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/mongoose [external] (mongoose, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$auth$2f5b2e2e2e$nextauth$5d2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/app/api/auth/[...nextauth]/route.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$utils$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/utils/db.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$Booking$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/models/Booking.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$Property$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/models/Property.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$User$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/models/User.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$BookedDateRange$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/models/BookedDateRange.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
async function GET(request, { params }) {
    try {
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$next$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$auth$2f5b2e2e2e$nextauth$5d2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
        if (!session || !session.user || !session.user.id) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Unauthorized: You must be logged in.'
            }, {
                status: 401
            });
        }
        const { bookingId } = params;
        if (!__TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Types.ObjectId.isValid(bookingId)) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Invalid booking ID format.'
            }, {
                status: 400
            });
        }
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$utils$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])();
        const booking = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$Booking$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findById(bookingId).populate({
            path: 'listingId',
            model: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$Property$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"],
            select: 'title images location hostId _id price pricePeriod availableFrom availableTo'
        }).populate({
            path: 'guestId',
            model: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$User$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"],
            select: 'name email avatarUrl _id'
        }).lean();
        if (!booking) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Booking not found.'
            }, {
                status: 404
            });
        }
        const isGuest = booking.guestId?._id.toString() === session.user.id;
        // Host check for property details for the property owner also.
        const isHost = booking.listingId?.hostId.toString() === session.user.id;
        const isAdmin = session.user.role === 'admin';
        if (!isGuest && !isAdmin && !isHost) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Forbidden: You are not authorized to view this booking.'
            }, {
                status: 403
            });
        }
        const propertyDetails = booking.listingId ? {
            id: booking.listingId._id.toString(),
            title: booking.listingId.title,
            mainImage: booking.listingId.images && booking.listingId.images.length > 0 ? booking.listingId.images[0] : undefined,
            location: booking.listingId.location,
            // Added for edit page potential display (though editing not implemented)
            price: booking.listingId.price,
            pricePeriod: booking.listingId.pricePeriod,
            availableFrom: booking.listingId.availableFrom,
            availableTo: booking.listingId.availableTo
        } : undefined;
        const guestDetails = booking.guestId ? {
            name: booking.guestId.name,
            email: booking.guestId.email,
            avatarUrl: booking.guestId.avatarUrl
        } : undefined;
        const responseBooking = {
            id: booking._id.toString(),
            listingId: booking.listingId?._id.toString(),
            guestId: booking.guestId?._id.toString(),
            startDate: booking.startDate,
            endDate: booking.endDate,
            totalPrice: booking.totalPrice,
            paymentStatus: booking.paymentStatus,
            bookingStatus: booking.bookingStatus,
            createdAt: booking.createdAt,
            propertyDetails,
            guestDetails
        };
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(responseBooking, {
            status: 200
        });
    } catch (error) {
        console.error(`[API /bookings/${params.bookingId} GET] Error:`, error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: 'Server error while fetching booking.',
            errorDetails: error.message
        }, {
            status: 500
        });
    }
}
async function DELETE(request, { params }) {
    try {
        const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2d$auth$2f$next$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$api$2f$auth$2f5b2e2e2e$nextauth$5d2f$route$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
        if (!session || !session.user || !session.user.id) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Unauthorized: You must be logged in.'
            }, {
                status: 401
            });
        }
        const { bookingId } = params;
        if (!__TURBOPACK__imported__module__$5b$externals$5d2f$mongoose__$5b$external$5d$__$28$mongoose$2c$__cjs$29$__["default"].Types.ObjectId.isValid(bookingId)) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Invalid booking ID format.'
            }, {
                status: 400
            });
        }
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$utils$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])();
        const booking = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$Booking$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findById(bookingId).populate({
            path: 'listingId',
            select: 'hostId _id'
        }).lean();
        if (!booking) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Booking not found.'
            }, {
                status: 404
            });
        }
        if (!booking.listingId || !booking.listingId.hostId) {
            console.error(`[API /bookings/${bookingId} DELETE] Booking ${booking._id} has no valid associated property or hostId.`);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Booking is not associated with a valid property or host.'
            }, {
                status: 500
            });
        }
        const isGuest = booking.guestId.toString() === session.user.id;
        const isHost = booking.listingId.hostId.toString() === session.user.id;
        const isAdmin = session.user.role === 'admin';
        let actionTakenMessage;
        if (isAdmin || isHost) {
            await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$Booking$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndDelete(booking._id);
            const deletedRange = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$BookedDateRange$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findOneAndDelete({
                bookingId: booking._id
            });
            actionTakenMessage = `Booking ${booking._id} and associated date range (if any) deleted by ${isAdmin ? 'admin' : 'host'}.`;
            console.log(`[API /bookings/${bookingId} DELETE] ${actionTakenMessage}`);
            if (deletedRange) {
                console.log(`[API /bookings/${bookingId} DELETE] Deleted BookedDateRange ${deletedRange._id}.`);
            } else {
                console.warn(`[API /bookings/${bookingId} DELETE] No BookedDateRange found to delete for booking ${booking._id}.`);
            }
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Booking successfully deleted.'
            }, {
                status: 200
            });
        } else if (isGuest) {
            if (booking.bookingStatus === 'pending_payment' || booking.bookingStatus === 'pending_confirmation') {
                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$Booking$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndDelete(booking._id);
                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$BookedDateRange$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findOneAndDelete({
                    bookingId: booking._id
                });
                actionTakenMessage = `Pending booking ${booking._id} cancelled and removed by guest.`;
                console.log(`[API /bookings/${bookingId} DELETE] ${actionTakenMessage}`);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    message: 'Booking successfully cancelled and removed.'
                }, {
                    status: 200
                });
            } else if (booking.bookingStatus === 'confirmed_by_host') {
                const updatedBooking = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$Booking$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findByIdAndUpdate(booking._id, {
                    $set: {
                        bookingStatus: 'cancelled_by_guest',
                        paymentStatus: 'refunded'
                    }
                }, {
                    new: true
                });
                await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$models$2f$BookedDateRange$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].findOneAndDelete({
                    bookingId: booking._id
                });
                actionTakenMessage = `Booking ${booking._id} status updated to 'cancelled_by_guest' by guest. Associated date range removed.`;
                console.log(`[API /bookings/${bookingId} DELETE] ${actionTakenMessage}`);
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    message: 'Booking successfully cancelled.',
                    booking: updatedBooking?.toObject()
                }, {
                    status: 200
                });
            } else {
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                    message: `Cannot cancel booking. Current status: '${booking.bookingStatus}'.`
                }, {
                    status: 409
                });
            }
        } else {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                message: 'Forbidden: You are not authorized to perform this action on this booking.'
            }, {
                status: 403
            });
        }
    } catch (error) {
        console.error(`[API /bookings/${params.bookingId} DELETE] Error:`, error);
        let errorMessage = 'An unexpected error occurred while managing the booking.';
        if (error.name === 'MongoNetworkError') {
            errorMessage = 'Database connection error.';
        } else if (error.message) {
            errorMessage = error.message;
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            message: errorMessage,
            errorDetails: error.toString()
        }, {
            status: 500
        });
    }
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    GET,
    DELETE
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(GET, "602adb3d8820c6476b5b7719ffc1ce4697076f5937", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(DELETE, "60846f5e79d056fa6b0ac9fb9099fa4a113147344b", null);
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__7e5393b5._.js.map